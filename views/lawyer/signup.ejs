<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>New Bee Lawyer Service</title>

    <script type="application/javascript" src="/js/jquery-1.11.3.min.js"></script>
    <script type="application/javascript" src="/js/validator.min.js"></script>
    <script type="application/javascript" src="/js/underscore-min.js"></script>
    <script type="application/javascript" src="/js/moment.js"></script>
    <script type="application/javascript" src="/js/modal.js"></script>
    <script type="application/javascript" src="/js/bootstrap-dialog.min.js"></script>
    <script type="application/javascript" src="/js/bootstrap.min.js"></script>
    <script type="application/javascript" src="/js/dialog.js"></script>
    <script type="application/javascript" src="/js/vue.min.js"></script>
    <script type="application/javascript" src="/js/model.js"></script>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-dialog.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
<!-- Fixed navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/" style="color: #00B7FF;">New Bee Lawyer Service</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">

            <!--
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-header">Nav header</li>
                        <li><a href="#">Separated link</a></li>
                        <li><a href="#">One more separated link</a></li>
                    </ul>
                </li>
            </ul>
            -->

            <ul class="nav navbar-nav navbar-right">
                <li><a href="/up/signup" style="color: #00B7FF;">注册</a></li>
                <li><a href="/up/signin" style="color: #00B7FF;">登陆</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>
<div class="container">
    <script type="text/javascript" xmlns="http://www.w3.org/1999/html">
        var options = <%-JSON.stringify(options)%>;
    </script>
<div class="panel panel-info" id="signupDiv">
	<div class="panel-heading">
		<h1 class="panel-title" style="font-size: 24px;">
			<strong>填写注册信息</strong>
		</h1>
	</div>
	<div class="panel-body">
		<div id="userForm" class="form-horizontal">
			<div class="form-group">
				<label for="username" class="control-label col-sm-4">用户名</label>
				<div class="col-sm-4">
					<input type="text" id="username" name="username" class="form-control" placeholder="输入用户名">
				</div>
			</div>
			<div class="form-group">
				<label for="email" class="control-label col-sm-4">邮箱</label>
				<div class="col-sm-4">
					<input type="email" id="email"  name="email" class="form-control" placeholder="输入邮箱地址">
				</div>
			</div>
			<div class="form-group">
				<label for="password" class="control-label col-sm-4">密码</label>
				<div class="col-sm-4">
					<input type="password" id="password" name="password" class="form-control" placeholder="新密码">
				</div>
			</div>
			<div class="form-group">
				<label for="cpassword" class="control-label col-sm-4">确认密码</label>
				<div class="col-sm-4">
					<input type="password" id="cpassword" name="cpassword" class="form-control" placeholder="确认新密码">
				</div>
			</div>

			<br>

			<div class="form-group">
				<label for="identityNumber" class="control-label col-sm-4">身份证号码</label>
				<div class="col-sm-4">
					<input type="text" id="identityNumber" name="identityNumber" class="form-control" placeholder="证件号码">
				</div>
			</div>

			<div class="form-group">
				<label for="identityImage" class="control-label col-sm-4">身份证照片</label>
				<div class="col-sm-4">
					<input type="file" accept="image/*" id="identityImage" name="identityImage">
				</div>
			</div>

			<br>

			<div class="form-group">
				<label for="lawyerId" class="control-label col-sm-4">律师执业证号</label>
				<div class="col-sm-4">
					<input type="text" id="lawyerId" name="lawyerId" class="form-control">
				</div>
			</div>

			<div class="form-group">
				<label for="lawyerLocation" class="control-label col-sm-4">律师所在律所详情</label>
				<div class="col-sm-4">
					<input type="text" id="lawyerLocation" name="lawyerLocation" class="form-control">
				</div>
			</div>

			<div class="form-group">
				<label for="lawServiceArea" class="control-label col-sm-4">法律擅长领域</label>
				<div class="col-sm-4">
					<input type="text" id="lawServiceArea" name="lawServiceArea" class="form-control">
				</div>
			</div>

			<div class="form-group">
				<label for="lawyerIdImage" class="control-label col-sm-4">律师执业证照片</label>
				<div class="col-sm-4">
					<input type="file" accept="image/*" id="lawyerIdImage" name="lawyerIdImage">
				</div>
			</div>
            <div class="form-group">
                <label for="phoneNumber" class="control-label col-sm-4">手机号码</label>
                <div class="col-sm-4">
                    <input type="text" id="phoneNumber" name="phoneNumber" class="form-control" placeholder="请填写手机号码">
                    <fieldset>
                        <input id="verifyCode" class="input-sm" type="text" placeholder="输入验证码">
                        <button class="btn btn-default" type="button" id="getVerifyCode">获取验证码</button>
                    </fieldset>

                    <br>
                    <br>
                    <div class="col-sm-4">
                        <button type="submit" class="btn btn-info" onclick="postLawyerData()">提交</button>
                    </div>
                </div>
            </div>
		</div>
	</div>
</div>

</div>
</body>
<script>

    $(function(){
        $('#getVerifyCode').click(function(){
            var mobile = $('#phoneNumber').val();
            if(!/\d{11}/.test(mobile)) return alert('请输入正确的手机号');
            $.post('/ua/lawyer/voicecode', {mobile:mobile}, function(data, status){
                if(data&& data.rtn > 0) alert('error'+data.message);
            });
        });
    });

	validator.authId = function(id){
		if(!id) return false;
		var re = new RegExp(/^[1-9]\d{16}[\d|x|X]$/g);
		return re.test(id);
	};

	function postLawyerData() {
		var formData = new FormData();
		var email = $('#email').val();
		if (!validator.isEmail(email)) return errorTip({code: 1, message: '邮箱格式错误'});
		var password = $('#password').val();
		var c_password = $('#cpassword').val();
		if (password != c_password) return errorTip({code: 1, message: '两次密码不一致'});

		var id = $('#identityNumber').val();
		if (!id) return errorTip({code: 1, message: '身份证号码不能为空'});
		if (!validator.authId(id)) return errorTip({code: 1, message: '身份证号码格式错误'});

        var phone = $('#phoneNumber').val();
        if (!/\d{11}/.test(phone)) return errorTip({code: 1, message: '手机号码格式错误'});
        var verifyCode = $('#verifyCode').val();
        if (!verifyCode) return errorTip({code: 1, message: '验证码不能为空'});

		var data = {
			username: $('#username').val(), password: password, email: email,
			phoneNumber: phone, verifyCode: verifyCode, identityNumber: id,
			identityImage: document.getElementById('identityImage').files[0],
			lawyerId: $('#lawyerId').val(),
			lawyerLocation: $('#lawyerLocation').val(),
			lawServiceArea: $('#lawServiceArea').val(),
			lawyerIdImage: document.getElementById('lawyerIdImage').files[0]
		};

		for (var key in data) {
			if (!data[key]) return errorTip({code: 1, message: 'Params error'});
			formData.append(key, data[key]);
		}

		var xhr = new XMLHttpRequest();
		xhr.open("POST", '/ua/signup', true);
		xhr.onload = function () {

			try {
				var res = typeof this.responseText === 'string' ? JSON.parse(this.responseText) : this.responseText;
			} catch (e) {
				return errorTip({code: 1, message: e});
			}

			var err = (res.code || res.rtn) && (res.code > 0 || res.rtn > 0) ? true : false;
			if (this.status == 200 && !err) {
				return successTip({code: 0, message: '注册成功'}, 1000 * 2, true);
				//return self.clearInput(['title', 'description', 'image', 'start', 'end']);
			}
			return errorTip(this.responseXML || this.responseText);
		};
		xhr.send(formData);
	}
</script>
</html>